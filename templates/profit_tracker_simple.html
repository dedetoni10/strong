<!-- Simple Profit Analytics Dashboard -->
<div class="stats-cards">
    <div class="stat-card">
        <div class="icon blue">
            <i class="fas fa-coins"></i>
        </div>
        <h3>Rp {{ "{:,.0f}".format(profit_stats.total_revenue) }}</h3>
        <p>Omzet Hari Ini</p>
    </div>
    <div class="stat-card">
        <div class="icon green">
            <i class="fas fa-chart-line"></i>
        </div>
        <h3>Rp {{ "{:,.0f}".format(profit_stats.total_profit) }}</h3>
        <p>Profit Hari Ini</p>
    </div>
    <div class="stat-card">
        <div class="icon orange">
            <i class="fas fa-percentage"></i>
        </div>
        <h3>{{ "{:.1f}".format(profit_stats.margin_percentage) }}%</h3>
        <p>Margin</p>
    </div>
    <div class="stat-card">
        <div class="icon cyan">
            <i class="fas fa-shopping-cart"></i>
        </div>
        <h3>{{ profit_stats.total_orders }}</h3>
        <p>Total Order</p>
    </div>
</div>

<!-- Simple Store Profit Summary -->
<div class="content-card">
    <div class="content-card-header">
        <h5><i class="fas fa-store"></i> Ringkasan Profit Toko</h5>
    </div>
    <div class="content-card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Toko</th>
                        <th>Omzet</th>
                        <th>Profit</th>
                        <th>Margin</th>
                        <th>Orders</th>
                    </tr>
                </thead>
                <tbody>
                    {% for store_data in store_profits %}
                    <tr>
                        <td><strong>{{ store_data.store_name }}</strong><br><small class="text-muted">{{ store_data.sku_code }}</small></td>
                        <td>Rp {{ "{:,.0f}".format(store_data.revenue) }}</td>
                        <td>Rp {{ "{:,.0f}".format(store_data.profit) }}</td>
                        <td>{{ "{:.1f}".format(store_data.margin) }}%</td>
                        <td>{{ store_data.orders }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Store Management - Manajemen Toko -->
<div class="content-card">
    <div class="content-card-header">
        <h5><i class="fas fa-store"></i> Manajemen Toko</h5>
    </div>
    <div class="content-card-body">
        <!-- Add New Store Form -->
        <div class="row mb-4">
            <div class="col-md-8">
                <form method="POST" action="{{ url_for('add_store') }}" class="row g-3">
                    <div class="col-md-4">
                        <label for="store_name" class="form-label">Nama Toko</label>
                        <input type="text" class="form-control" id="store_name" name="store_name" placeholder="MITRA JAYA PARTS" required>
                    </div>
                    <div class="col-md-3">
                        <label for="sku_code" class="form-label">Kode SKU</label>
                        <input type="text" class="form-control" id="sku_code" name="sku_code" placeholder="MJP" maxlength="5" required style="text-transform: uppercase;">
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-plus"></i> Tambah Toko
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Stores List -->
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th width="5%">No</th>
                        <th width="40%">Nama Toko</th>
                        <th width="15%">Kode SKU</th>
                        <th width="15%">Status</th>
                        <th width="15%">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for store in stores %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ store.store_name }}</td>
                        <td><span class="badge bg-primary">{{ store.sku_code }}</span></td>
                        <td>
                            {% if store.is_active %}
                                <span class="badge bg-success">Aktif</span>
                            {% else %}
                                <span class="badge bg-secondary">Nonaktif</span>
                            {% endif %}
                        </td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editStore({{ store.id }}, '{{ store.store_name }}', '{{ store.sku_code }}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            {% if not store.is_active %}
                            <button class="btn btn-sm btn-danger" onclick="deleteStore({{ store.id }}, '{{ store.store_name }}')" title="Hapus Toko">
                                <i class="fas fa-trash"></i>
                            </button>
                            {% else %}
                            <button class="btn btn-sm btn-secondary" onclick="toggleStoreStatus({{ store.id }}, false)" title="Nonaktifkan">
                                <i class="fas fa-pause"></i>
                            </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Settings - Pengaturan Biaya -->
<div class="content-card">
    <div class="content-card-header">
        <h5><i class="fas fa-cog"></i> Pengaturan Biaya</h5>
    </div>
    <div class="content-card-body">
        <form method="POST" action="{{ url_for('profit_tracker_settings') }}">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="admin_fee" class="form-label">Admin Fee (%)</label>
                        <div class="input-group">
                            <select class="form-select" id="admin_fee" name="admin_fee_percentage">
                                <option value="0" {% if current_settings.admin_fee_percentage == 0 %}selected{% endif %}>0%</option>
                                <option value="8" {% if current_settings.admin_fee_percentage == 8 %}selected{% endif %}>8%</option>
                                <option value="11" {% if current_settings.admin_fee_percentage == 11 %}selected{% endif %}>11%</option>
                                <option value="15" {% if current_settings.admin_fee_percentage == 15 %}selected{% endif %}>15%</option>
                            </select>
                            <span class="input-group-text">Simpan</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="fee_per_order" class="form-label">Biaya per Order (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="fee_per_order" name="fee_per_order" 
                                   value="{{ current_settings.fee_per_order or 1250 }}" min="0" step="250">
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="insurance_fee" class="form-label">Biaya Asuransi (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="insurance_fee" name="insurance_fee" 
                                   value="{{ current_settings.insurance_fee or 350 }}" min="0" step="50">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="advertising_cost" class="form-label">Biaya Iklan Hari Ini (Rp)</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="advertising_cost" name="advertising_cost" 
                                   value="{{ today_advertising_cost or 0 }}" min="0" step="1000">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-12">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Simpan Pengaturan
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
/* Simple and elegant styles */
.content-card-header {
    background: linear-gradient(135deg, #6f42c1, #8b5cf6) !important;
}

.stat-card .icon.blue { background-color: #3498db; }
.stat-card .icon.green { background-color: #27ae60; }
.stat-card .icon.orange { background-color: #f39c12; }
.stat-card .icon.cyan { background-color: #17a2b8; }

.table th {
    background-color: #f8f9fa;
    border-top: none;
    font-weight: 600;
    font-size: 0.85rem;
}

.table td {
    vertical-align: middle;
    font-size: 0.9rem;
}

.table-striped tbody tr:nth-of-type(odd) {
    background-color: #f8f9fa;
}

.form-label {
    font-weight: 600;
    color: #495057;
}

.input-group-text {
    background-color: #e9ecef;
    border-color: #ced4da;
    font-size: 0.9rem;
}
</style>

<script>
// Store Management Functions
function editStore(storeId, storeName, skuCode) {
    const newStoreName = prompt('Edit Nama Toko:', storeName);
    const newSkuCode = prompt('Edit Kode SKU:', skuCode);
    
    if (newStoreName && newSkuCode) {
        fetch(`/store/${storeId}/update`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                store_name: newStoreName,
                sku_code: newSkuCode.toUpperCase()
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Toko berhasil diupdate!');
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        });
    }
}

function deleteStore(storeId, storeName) {
    if (confirm(`Hapus toko "${storeName}"?`)) {
        fetch(`/store/${storeId}/delete`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Toko berhasil dihapus!');
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        });
    }
}

function toggleStoreStatus(storeId, isActive) {
    const action = isActive ? 'aktifkan' : 'nonaktifkan';
    if (confirm(`${action} toko ini?`)) {
        fetch(`/store/${storeId}/toggle`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                is_active: isActive
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`Toko berhasil di${action}!`);
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        });
    }
}

// Auto uppercase for SKU input
document.addEventListener('DOMContentLoaded', function() {
    const skuInput = document.getElementById('sku_code');
    if (skuInput) {
        skuInput.addEventListener('input', function() {
            this.value = this.value.toUpperCase();
        });
    }
});
</script>